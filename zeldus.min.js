/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license Zeldus 0.1.1 Copyright (c) 2014, Roger Noble All Rights Reserved.
 * Licensed under MIT.
 * See https://raw.githubusercontent.com/RogerNoble/zeldus/master/LICENSE
 */

!function(t,e){"function"==typeof define?define(e):"object"==typeof exports?module.exports=e():t.Zeldus=e()}(this,function(){var t,e,n;return function(o){function r(t,e){return m.call(t,e)}function i(t,e){var n,o,r,i,l,u,a,c,s,f,p,h=e&&e.split("/"),d=k.map,g=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(h=h.slice(0,h.length-1),t=t.split("/"),l=t.length-1,k.nodeIdCompat&&b.test(t[l])&&(t[l]=t[l].replace(b,"")),t=h.concat(t),s=0;s<t.length;s+=1)if(p=t[s],"."===p)t.splice(s,1),s-=1;else if(".."===p){if(1===s&&(".."===t[2]||".."===t[0]))break;s>0&&(t.splice(s-1,2),s-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||g)&&d){for(n=t.split("/"),s=n.length;s>0;s-=1){if(o=n.slice(0,s).join("/"),h)for(f=h.length;f>0;f-=1)if(r=d[h.slice(0,f).join("/")],r&&(r=r[o])){i=r,u=s;break}if(i)break;!a&&g&&g[o]&&(a=g[o],c=s)}!i&&a&&(i=a,u=c),i&&(n.splice(0,u,i),t=n.join("/"))}return t}function l(t,e){return function(){return h.apply(o,y.call(arguments,0).concat([t,e]))}}function u(t){return function(e){return i(e,t)}}function a(t){return function(e){v[t]=e}}function c(t){if(r(x,t)){var e=x[t];delete x[t],O[t]=!0,p.apply(o,e)}if(!r(v,t)&&!r(O,t))throw new Error("No "+t);return v[t]}function s(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function f(t){return function(){return k&&k.config&&k.config[t]||{}}}var p,h,d,g,v={},x={},k={},O={},m=Object.prototype.hasOwnProperty,y=[].slice,b=/\.js$/;d=function(t,e){var n,o=s(t),r=o[0];return t=o[1],r&&(r=i(r,e),n=c(r)),r?t=n&&n.normalize?n.normalize(t,u(e)):i(t,e):(t=i(t,e),o=s(t),r=o[0],t=o[1],r&&(n=c(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:n}},g={require:function(t){return l(t)},exports:function(t){var e=v[t];return"undefined"!=typeof e?e:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:f(t)}}},p=function(t,e,n,i){var u,s,f,p,h,k,m=[],y=typeof n;if(i=i||t,"undefined"===y||"function"===y){for(e=!e.length&&n.length?["require","exports","module"]:e,h=0;h<e.length;h+=1)if(p=d(e[h],i),s=p.f,"require"===s)m[h]=g.require(t);else if("exports"===s)m[h]=g.exports(t),k=!0;else if("module"===s)u=m[h]=g.module(t);else if(r(v,s)||r(x,s)||r(O,s))m[h]=c(s);else{if(!p.p)throw new Error(t+" missing "+s);p.p.load(p.n,l(i,!0),a(s),{}),m[h]=v[s]}f=n?n.apply(v[t],m):void 0,t&&(u&&u.exports!==o&&u.exports!==v[t]?v[t]=u.exports:f===o&&k||(v[t]=f))}else t&&(v[t]=n)},t=e=h=function(t,e,n,r,i){if("string"==typeof t)return g[t]?g[t](e):c(d(t,e).f);if(!t.splice){if(k=t,k.deps&&h(k.deps,k.callback),!e)return;e.splice?(t=e,e=n,n=null):t=o}return e=e||function(){},"function"==typeof n&&(n=r,r=i),r?p(o,t,e,n):setTimeout(function(){p(o,t,e,n)},4),h},h.config=function(t){return h(t)},t._defined=v,n=function(t,e,n){e.splice||(n=e,e=[]),r(v,t)||r(x,t)||(x[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("lib/almond/almond",function(){}),n("utils/QueryParser",[],function(){function t(t,e){if(void 0===e)return null;var o=["and","or"],r=["=",">","<",">=","<=","<>","!="],i=["E","GT","LT","GTE","LTE","NE","NE"],l=e.split(new RegExp("( "+o.join(" | ")+" )"));l=l.map(function(t){return t.trim()});for(var u=[],a={type:null,children:[]},c=0;c<l.length;c++)if(o.indexOf(l[c].toLowerCase())<0){var s=l[c].split(new RegExp("("+r.join("|")+")")),f={value:null,type:null};if(s=s.map(function(t){return t.trim()}),3===s.length){var p=r.indexOf(s[1]);p>=0&&(f.type=i[p]),f.value=n(s[2]),u.push({type:"ds",table:t,column:s[0],predicate:f})}}else a.type=l[c];return u.length<=1?u:u.length>1&&null!=a.type?(a.children=u,a):null}function e(t,e){var n=e.split(","),o={type:"select",filter:[],children:[]};n=n.map(function(t){return t.trim().toLowerCase()});for(var r=0;r<n.length;r++)o.children.push({type:"ds",table:t,column:n[r]});return o}function n(t){var e=+t;if(!isNaN(e))return e;var n=Date.parse(t);return isNaN(n)?t:e}function o(){var n=this,o=["select","from","where","sum","count","join"];n.parse=function(n){n=n.replace(/(\r\n|\n|\r)/gm,"");for(var r=n.split(new RegExp("("+o.join("|")+")")),i=null,l={},u=0;u<r.length;u++)r[u].length>0&&(o.indexOf(r[u])>=0?i=r[u]:(l[i]=r[u].trim(),i=null));var a=l.from,c=t(a,l.where),s=e(a,l.select);if(null!=c)if(void 0!==c.type)s.filter.push(c);else if(c.length>0)for(var u=0;u<c.length;u++){for(var f=!1,p=0;p<s.children.length;p++)if(s.children[p].table===c[u].table&&s.children[p].column===c[u].column){f=!0;break}f?s.children[p]=c[u]:s.filter.push(c[u])}return s}}return o}),n("blocks/Block",[],function(){function t(){var t=this;t.hasNext=function(){},t.getNext=function(){},t.peekNext=function(){},t.getPairAtLoc=function(){},t.getCurrLoc=function(){},t.getSize=function(){},t.resetBlock=function(){},t.isValueSorted=function(){return!0},t.isPosSorted=function(){return!0},t.isOneValue=function(){return!0},t.isPosContiguous=function(){return!0},t.isBlockValueSorted=function(){return!0},t.isBlockPosSorted=function(){return!0}}return t}),n("blocks/BasicBlock",["blocks/Block"],function(t){function e(e,n){var o=this;t.call(this),this.value=e,this.position=n,o.getNext=function(){return{value:this.value,position:this.position}},o.getSize=function(){return 1}}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}),n("operators/Operator",[],function(){function t(t){var e=this;e.childOperator=t,e.getNextValueBlock=function(){},e.getNextPositionBlock=function(){}}return t}),n("operators/AndOperator",["operators/Operator","blocks/BasicBlock"],function(t,e){function n(n,o){var r=this;this.rightOperator=o,t.call(this,n),r.getNextValueBlock=function(){if(null!=this.childOperator&&null!=this.rightOperator){var t=this.childOperator.getNextValueBlock(),n=this.rightOperator.getNextValueBlock();if(null==t||null==n)return null;if(t.position===n.position)return new e(!0,t.position);var o=!1;do null==t||null==n?o=!0:t.position===n.position?o=!0:t.position>n.position?n=this.rightOperator.getNextValueBlock():t.position<n.position&&(t=this.childOperator.getNextValueBlock());while(!o);if(null==t||null==n)return null}return new e(!0,t.position)},r.getNextPositionBlock=function(){}}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n}),n("operators/Predicate",[],function(){function t(t,e){var n=this;this.value=t,this.type=e,n.evaluate=function(t){var e=!1;switch(this.type){case"GT":e=t.value>this.value;break;case"GTE":e=t.value>=this.value;break;case"LT":e=t.value<this.value;break;case"LTE":e=t.value<=this.value;break;case"NE":e=t.value!==this.value;break;default:e=t.value===this.value}return e}}return t}),n("operators/DataSourceOperator",["operators/Operator","operators/Predicate"],function(t,e){function n(n,o,r){function i(t){var e=null;return null!=l.childOperator?e=l.childOperator.getNextValueBlock():null!=t&&t<n.length?(e=l.column[t],l.index=t+1):void 0!==l.column&&l.column.length>l.index&&(e=l.column[l.index],l.index++),e}var l=this;if(l.childOperator=r,l.column=n,l.index=0,null!=o&&!(o instanceof e))throw"Predicate is not an instance of Predicate";t.call(this,r),l.getNextValueBlock=function(e){var n=i(e),r=!1;do null==n?r=!0:null==o||null!=o&&(o instanceof t||o.evaluate(n.getNext()))?r=!0:n=i(e);while(!r);return n},l.getNextPositionBlock=function(){}}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n}),n("operators/CountOperator",["operators/Operator","blocks/BasicBlock"],function(t,e){function n(n){var o=this;t.call(this,n),o.getNextValueBlock=function(){var t=null,n=0;if(null!=this.childOperator){if(t=this.childOperator.getNextValueBlock(),null==t)return null;do n+=t.getSize(),t=this.childOperator.getNextValueBlock();while(null!=t)}return new e(n,0)},o.getNextPositionBlock=function(){}}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n}),n("operators/SelectOperator",["operators/Operator","blocks/BasicBlock"],function(t){function e(e,n){var o=this;if(o.index=0,o.operators=arguments,null!=e&&!(e instanceof t))throw"Filter operator is not an instance of Operator.";if(!(n instanceof t))throw"Child operator is not an instance of Operator.";t.call(this,n),o.getNextValueBlock=function(){var t=null,n=[],r=!1;if(null!=this.childOperator)for(;!r;){var i=null,l=[];if(null!=e){var u=e.getNextValueBlock();i=null!=u?u.getNext().position:null,null==i&&(r=!0)}if(!r)for(var a=1;a<o.operators.length;a++){if(t=o.operators[a].getNextValueBlock(i),null==t){r=!0;break}l.push(t)}r||n.push(l)}return n.length>0?n:null},o.getNextPositionBlock=function(){}}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}),n("operators/SumOperator",["operators/Operator","blocks/BasicBlock"],function(t){function e(e,n){var o=this;if(o.index=0,o.operators=arguments,null!=e&&!(e instanceof t))throw"Filter operator is not an instance of Operator.";if(!(n instanceof t))throw"Child operator is not an instance of Operator.";t.call(this,n),o.getNextValueBlock=function(){var t=null,n=[],r=!1;if(null!=this.childOperator)for(;!r;){var i=null,l=[];if(null!=e){var u=e.getNextValueBlock();i=null!=u?u.getNext().position:null,null==i&&(r=!0)}if(!r)for(var a=1;a<o.operators.length;a++){if(t=o.operators[a].getNextValueBlock(i),null==t){r=!0;break}l.push(t)}r||n.push(l)}return n.length>0?n:null},o.getNextPositionBlock=function(){}}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}),n("common/OperatorFactory",["operators/AndOperator","operators/DataSourceOperator","operators/CountOperator","operators/SelectOperator","operators/SumOperator","operators/Predicate"],function(t,e,n,o,r,i){function l(l){var u=this,a={and:t,count:n,ds:e,select:o,sum:r};u.tables=l,Function.prototype.construct||(Function.prototype.construct=function(t){var e=this,n=function(){e.apply(this,t)};return n.prototype=e.prototype,new n}),u.get=function(t){var e=[];if(void 0!==t.table&&void 0!==t.column){if(void 0===u.tables[t.table]||void 0===u.tables[t.table][t.column])throw"column "+t.column+" does not exist";e.push(u.tables[t.table][t.column])}if(void 0!==t.predicate&&e.push(new i(t.predicate.value,t.predicate.type)),void 0!==t.filter)if(0===t.filter.length)e.push(null);else for(var n=0;n<t.filter.length;n++)e.push(this.get(t.filter[n]));if(void 0!==t.children)for(var n=0;n<t.children.length;n++)e.push(this.get(t.children[n]));return a[t.type].construct(e)}}return l}),n("common/ResultPrinter",["operators/Operator","blocks/Block"],function(t,e){function n(t,n){var o=this;o.getJSON=function(o){var r=[],i=t.getNextValueBlock();if(null==i)return void o(r);do{if(i instanceof e)r[n[0]]=i.getNext().value;else if(i.length>0)for(var l=0;l<i.length;l++){for(var u={},a=0;a<i[l].length;a++)i[l][a]instanceof e&&(u[n[a]]=i[l][a].getNext().value);r.push(u)}i=t.getNextValueBlock()}while(null!=i);o(r)}}return n}),n("Zeldus",["utils/QueryParser","blocks/BasicBlock","common/OperatorFactory","common/ResultPrinter"],function(t,e,n,o){function r(t,e){var r=new n(l),i=new Date,u=t.children.map(function(t){return t.column}),a=r.get(t),c=new o(a,u);c.getJSON(function(n){var o=new Date;console.log("Query execution: "+(o-i)/1e3+" seconds"),e(n,t)})}function i(n){function o(t,n){l[t]={};for(var o=0;o<n.length;o++)for(var r in n[o])n[o].hasOwnProperty(r)&&(void 0===l[t][r]&&(l[t][r]=[]),l[t][r].push(new e(n[o][r],o)));var a=new Date;console.log("Data load: "+(a-i.loadStart)/1e3+" seconds"),u()}var i=this,u=null;if(n.dataSource){i.loadStart=new Date;for(var a=0;a<n.dataSource.length;a++)n.dataSource[a].get(o)}i.createProjection=function(){},i.execute=function(e,n){var o=new t,i=o.parse(e);console.log(JSON.stringify(i)),r(i,n)},i.onDataLoaded=function(t){u=t},i.version="0.1.2"}var l={};return i}),e("Zeldus")});